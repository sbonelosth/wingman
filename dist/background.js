/*! For license information please see background.js.LICENSE.txt */
(()=>{function e(){var t,r,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function c(e,o,i,a){var c=o&&o.prototype instanceof u?o:u,f=Object.create(c.prototype);return n(f,"_invoke",function(e,n,o){var i,a,c,u=0,f=o||[],l=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return i=e,a=0,c=t,p.n=n,s}};function d(e,n){for(a=e,c=n,r=0;!l&&u&&!o&&r<f.length;r++){var o,i=f[r],d=p.p,h=i[2];e>3?(o=h===n)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=d&&((o=e<2&&d<i[1])?(a=0,p.v=n,p.n=i[1]):d<h&&(o=e<3||i[0]>n||n>h)&&(i[4]=e,i[5]=n,p.n=h,a=0))}if(o||e>1)return s;throw l=!0,n}return function(o,f,h){if(u>1)throw TypeError("Generator is already running");for(l&&1===f&&d(f,h),a=f,c=h;(r=a<2?t:c)||!l;){i||(a?a<3?(a>1&&(p.n=-1),d(a,c)):p.n=c:p.v=c);try{if(u=2,i){if(a||(o="next"),r=i[o]){if(!(r=r.call(i,c)))throw TypeError("iterator result is not an object");if(!r.done)return r;c=r.value,a<2&&(a=0)}else 1===a&&(r=i.return)&&r.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((r=(l=p.n<0)?c:e.call(n,p))!==s)break}catch(e){i=t,a=1,c=e}finally{u=1}}return{value:r,done:l}}}(e,i,a),!0),f}var s={};function u(){}function f(){}function l(){}r=Object.getPrototypeOf;var p=[][i]?r(r([][i]())):(n(r={},i,function(){return this}),r),d=l.prototype=u.prototype=Object.create(p);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,n(e,a,"GeneratorFunction")),e.prototype=Object.create(d),e}return f.prototype=l,n(d,"constructor",l),n(l,"constructor",f),f.displayName="GeneratorFunction",n(l,a,"GeneratorFunction"),n(d),n(d,a,"Generator"),n(d,i,function(){return this}),n(d,"toString",function(){return"[object Generator]"}),(e=function(){return{w:c,m:h}})()}function n(e,t,r,o){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}n=function(e,t,r,o){function a(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?i?i(e,t,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},n(e,t,r,o)}function t(e,n,t,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void t(e)}c.done?n(s):Promise.resolve(s).then(r,o)}function r(e){return function(){var n=this,r=arguments;return new Promise(function(o,i){var a=e.apply(n,r);function c(e){t(a,o,i,c,s,"next",e)}function s(e){t(a,o,i,c,s,"throw",e)}c(void 0)})}}function o(e){return i.apply(this,arguments)}function i(){return(i=r(e().m(function n(t){var r,o,i,a;return e().w(function(e){for(;;)switch(e.n){case 0:return(o=new FormData).append("file",t),e.n=1,fetch("http://127.0.0.1:5000/extract-text",{method:"POST",body:o});case 1:return i=e.v,e.n=2,i.json();case 2:if(a=e.v,i.ok){e.n=3;break}throw new Error((null===(r=a.error)||void 0===r?void 0:r.message)||"File upload failed");case 3:return e.a(2,a)}},n)}))).apply(this,arguments)}function a(e,n){return c.apply(this,arguments)}function c(){return(c=r(e().m(function n(t,r){var o,i,a,c,s,u;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return a='\n    You are an AI career assistant.\n    You will receive:\n    1. A job description (plain text).\n    2. A resume\'s extracted text.\n\n    Your task:\n    - Avoid speaking third person.\n    - Compare the resume against the job description.\n    - Decide if the candidate should apply ("Yes") or not ("No").\n    - Justify your decision in 1 informed sentence, by speaking directly to the candidate, not in third person.\n    - Provide a match score from 0 to 100.\n    - ONLY generate a "coverLetter" if decision is "Yes" AND score is 60 or higher.\n    - If decision is "No" or score < 60, set "coverLetter" to an empty string "".\n    - If decision is "Yes", based on the job requirements, suggest the exact resume enhancements to make it ATS friendly and increase the chances of the candidate at being considered.\n    - Speak directly to the user, not in third person, e.g "You do not have the required qualification for this role."\n\n    Respond ONLY in this exact JSON format with no extra text:\n\n    {\n      "decision": "Yes" or "No",\n      "reason": "<1 sentence explaining decision>",\n      "score": <percentage number from 0 to 100>,\n      "coverLetter": "<cover letter text or empty string>",\n      "resumeEnhancements": "<suggestions for ATS friendly resume>"\n    }\n\n    Job Description:\n    '.concat(t,"\n\n    Resume:\n    ").concat(r,"\n  "),e.n=1,fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=".concat("AIzaSyBZneyhOjQ8S_TcsMTg2tK8hi0AsKfhRW4"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{role:"user",parts:[{text:a}]}]})});case 1:return c=e.v,e.n=2,c.json();case 2:if(s=e.v,c.ok){e.n=3;break}throw new Error((null===(o=s.error)||void 0===o?void 0:o.message)||"Gemini analysis failed");case 3:return(u=(u=(null===(i=s.candidates)||void 0===i||null===(i=i[0])||void 0===i||null===(i=i.content)||void 0===i||null===(i=i.parts)||void 0===i||null===(i=i[0])||void 0===i?void 0:i.text)||"").trim()).startsWith("```")&&(u=u.replace(/^```json/i,"").replace(/^```/,"").replace(/```$/,"").trim()),e.p=4,e.a(2,JSON.parse(u));case 5:throw e.p=5,e.v,new Error("Invalid JSON from Gemini");case 6:return e.a(2)}},n,null,[[4,5]])}))).apply(this,arguments)}function s(e,n){for(var t=atob(e),r=new Array(t.length),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);var i=new Uint8Array(r);return new Blob([i],{type:n})}chrome.runtime.onMessage.addListener(function(n,t,i){if("ANALYZE_RESUME"===n.type)return r(e().m(function t(){var r,c,u,f,l,p;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,r=s(n.fileBase64,"application/octet-stream"),c=new File([r],n.fileName),e.n=1,o(c);case 1:return u=e.v,f=u.text,e.n=2,a(n.jobDescription,f);case 2:l=e.v,i({result:l}),e.n=4;break;case 3:e.p=3,p=e.v,i({error:p.message});case 4:return e.a(2)}},t,null,[[0,3]])}))(),!0})})();